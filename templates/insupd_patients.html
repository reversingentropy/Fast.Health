{% extends "parent.html" %}
{% block title %}Patients{% endblock %}
{% block head %}
	{{ super() }}
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
{% endblock %}
{% block content %}
<!-- Bootstrap Date-Picker Plugin -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
	<!-- JQuery Validation Plugin -->
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js"></script>
<script type="text/javascript" language="javascript">
    $(document).ready(function(){
      var date_input=$('input[name="dob"]'); //our date input has the name "date"
      var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
      var options={
        format: 'yyyy/mm/dd',
        container: container,
        todayHighlight: true,
        autoclose: true,
/*		onSelect: function(value, ui) {
			var today = new Date();
			age = today.getFullYear() - ui.selectedYear;
			$('#age').val(age);			
			},
		*/      };
      date_input.datepicker(options);
	  date_input.datepicker().on("hide", function(ev){
		var yearSelect = $('#dob').val().split("/")[0];
		var yearDate = new Date().getFullYear();
		age = yearDate - yearSelect;
		$("#age").val(age);
      });


	  $.validator.addMethod(
			"regex",
			function(value, element, regexp) 
			{
//				var check = false;
				var re = RegExp(regexp);
				return this.optional(element) || re.test(value);
    		},
		    ""
		);

	  /* Functions for checking validation */
	  	$("form[name='formInsUpdPatient']").validate({
			rules:{
				name: "required",
				address: "required",
				gender: {
					required: true,
					regex: /^(?:m|M|male|Male|f|F|female|Female)$/
				},
				nricno:  {
					required: true,
					minlength: 9,
					maxlength: 9,
					regex: /^[STFG]\d{7}[A-Z]$/
				},
				email: {
					required: true,
					email: true
				},
				age:  {
					required: true,
					digits: true,
					range: [1, 150]
				},
				contactno: {
					required: true,
					digits: true,
					minlength: 8,
					maxlength: 20
				},
				postcode : {
					required: true,
					digits: true,
					minlength: 6,
					maxlength: 6
				},
				dob: {
					required: true,
					date: true
				}
			},
			messages: {
				name: "Plesae enter your name.",
				gender: "Please choose your gender.",
				nricno: "Please enter a valid NRIC No.",
				email : "Please enter a valid email address.",
				address: "Please enter your address",
				contactno: "Please enter your contact number (Max:20 digits).",
				postcode: "Pleae enter a valid postcode.",
				dob: "Please enter a valid date.",
				age: "Please enter a valid age (1-150)"
			},

	  });
	});

	function selectElement(id, valueToSelect) {    
    	let element = document.getElementById(id);
    	element.value = valueToSelect;
	};
</script>
<style>
	.container {
		display: grid;
		grid-template-columns: auto;
		grid-gap: 10px;
		border: 3px solid rgb(253, 253, 253);
		background-color:rgb(235, 214, 187);
		padding-top: 20px;
		padding-left: 20px;
	}

	.error{
		color: rgb(209, 17, 17);
		font-style:normal;
		}

</style>
	<h3 style="text-align:center; color:White">New Patient</h3>
	<br />
		<div class="container">
			<form action="/patient" method="POST" id="formInsUpdPatient" name="formInsUpdPatient" >
				<input type="hidden" id="patientid" name="patientid" value="{{patient_dict['patientid'] }}">
				<div class="form-row">
					<div class="form-group col-md-9">
						<label for="name" class="form-label">Name</label>
						<input type="text" rqquired class="form-control" id="name" name="name" value="{{patient_dict['patientname'] }}" >
					</div>
					<div class="form-group col-md-3" >
						<label for="gender" class="form-label">Gender</label>
						<select class="form-control form-select" id="gender" name="gender" rquired >
								<option>Choose...</option>
								<option value="Male">Male </option>
								<option value="Female">Female</option>		
								<script>
									if ( "{{ action }}" == 'update' ) {
										selectElement('gender', '{{patient_dict['gender']}}');	
									};
								</script>
						</select>
					</div>
				</div>				
				<div class="form-row">
					<div class="form-group  col-4">
						<label for="nricno" class="form-label">NRIC No.</label>
						<input type="text" class="form-control" id="nricno" name="nricno" placeholder="SXXXXXXX" value="{{patient_dict['nricno']}}">
					</div>
					<div class="form-group col-md-4">
						<label for="dob" class="form-label">Date of Birth</label>
						<input type="text" class="form-control" id="dob" name="dob" placeholder="YYYY/MM/DD" value="{{patient_dict['dob'] }}">	
					</div>
					<div class="form-group col-md-4">
						<label for="age" class="form-label">Age</label>
						<input readonly type="text" class="form-control" id="age" name="age" value="{{patient_dict['age']}}">
					</div>
				</div>
				<div class="form-row">
					<div class="col-6">
						<label for="email" class="form-label">Email</label>
						<input type="email" class="form-control" id="email" name="email" placeholder="" value="{{patient_dict['email']}}">
					</div>
					<div class="col-6">
						<label for="contactno" class="form-label">Contact Number</label>
						<input type="tel" class="form-control" id="contactno" name="contactno" value="{{patient_dict['contactno']}}" >
					</div>
				</div>
				<div class="form-row">
					<div class="col-9">
						<label for="address" class="form-label">Address</label>
						<input type="text" class="form-control" id="address" name="address" placeholder="Apartment, studio, or floor" value="{{patient_dict['address']}}">
					</div>
					<div class="col-md-3">
						<label for="postcode" class="form-label">Postcode</label>
						<input type="number" class="form-control" id="postcode" name="postcode" value="{{patient_dict['postcode']}}">
					</div>
				</div>
				<br>
				<div class="form-row">
					<div class="col-xs-3>">
						{% if action == 'insert' %}
					  	<button type="submit" class="btn btn-primary btn-lg" name="action" value="insert">Add</button>
						{% else %}
						<button type="submit" class="btn btn-primary btn-lg" name="action" value="update">Update</button>
						{% endif %}
					</div>
					<div class="col-xs-3>">
						<button type="reset" class="btn btn-primary btn-lg" value="Reset">Clear</button>
					</div>
				</div>
				<br>
			</form>			
		</div>
		<div class="card" style="width: 18rem;">
			<div class="card-body">
				<h5 class="card-title">Status:</h5>
				<p class="card-text">{{message}}</p>
			</div>
			</div>
<br />
<br />

{% endblock %}